import returnObjectFromArray from "./objectLogic";
import { updateProjView } from "./domManager";

// Define priority options array
const priorityOptionsArray = ["none", "low", "medium", "high"];

// Function for initializing form
function initForm() {
  // Create form background
  const formBackground = document.createElement("div");
  formBackground.classList.add("form-background");
  // Create form container
  const formContainer = document.createElement("div");
  formContainer.classList.add("form-container");

  // Append container to background element
  formBackground.appendChild(formContainer);

  // Add form container to document
  const content = document.querySelector(".content-container");
  content.appendChild(formBackground);
}

// Function for adding name input elements
function addNameInput(currentName) {
  // Get the form container
  const formContainer = document.querySelector(".form-container");

  // Add container for name elements
  const nameDiv = document.createElement("div");
  nameDiv.classList.add("form-div");
  // Add label for name input
  const nameLabel = document.createElement("label");
  nameLabel.setAttribute("for", "name-input");
  nameLabel.textContent = "Name:";
  // Add input for name and set attributes
  const nameInput = document.createElement("input");
  nameInput.setAttribute("type", "text");
  nameInput.setAttribute("id", "name-input");
  nameInput.setAttribute("name", "name-input");
  // Set input as required
  nameInput.required = true;
  // Set input value to current name
  nameInput.value = currentName;

  // Append both label and input for name to name container
  nameDiv.appendChild(nameLabel);
  nameDiv.appendChild(nameInput);
  // Append the name container to form container
  formContainer.appendChild(nameDiv);
}

// Function for adding priority select input elements
function addPriorityInput(currentPriority) {
  // Get the form container
  const formContainer = document.querySelector(".form-container");

  // Add container for priority elements
  const priorityDiv = document.createElement("div");
  priorityDiv.classList.add("form-div");
  // Add label for priority select
  const priorityLabel = document.createElement("label");
  priorityLabel.setAttribute("for", "priority-input");
  priorityLabel.textContent = "Priority:";
  // Add priority select element
  const prioritySelect = document.createElement("select");
  prioritySelect.name = "priority-input";
  // Loop through options array
  priorityOptionsArray.forEach((element) => {
    // Create option element
    const priorityOption = document.createElement("option");
    // Set option value to the string of each array item
    priorityOption.setAttribute("value", element);
    // Get string for option name
    const optionName = element;
    // Get the first letter of the name
    const firstLetter = optionName.charAt(0);
    // Set the text to name with capital first letter
    priorityOption.innerText = firstLetter.toUpperCase() + optionName.slice(1);
    // Add option element to select element
    prioritySelect.appendChild(priorityOption);
  });
  // Set select value to current priority
  prioritySelect.value = currentPriority;
  // Set ID attribute for select element
  prioritySelect.setAttribute("id", "priority-input");

  // Add the select elements to priority container
  priorityDiv.appendChild(priorityLabel);
  priorityDiv.appendChild(prioritySelect);
  // Append the priority container to the form container
  formContainer.appendChild(priorityDiv);
}

// Function for adding info input elements
function addInfoInput(currentInfo) {
  // Get the form container
  const formContainer = document.querySelector(".form-container");

  // Add container for info
  const infoDiv = document.createElement("div");
  infoDiv.classList.add("form-div");
  // Add label for info box
  const infoLabel = document.createElement("label");
  infoLabel.setAttribute("for", "info-input");
  infoLabel.textContent = "Info:";
  // Add info text area element
  const infoInput = document.createElement("textarea");
  infoInput.name = "info-input";
  // Set ID attribute for info text area input element
  infoInput.setAttribute("id", "info-input");
  // Set info text area value to current info
  infoInput.value = currentInfo;

  // Add the info elements to info container
  infoDiv.appendChild(infoLabel);
  infoDiv.appendChild(infoInput);
  // Append the info container to the form container
  formContainer.appendChild(infoDiv);
}

// Function for adding button elements
function addButtons(proj, obj, priorityBool) {
  console.log(obj.type);

  // Get the form background
  const formBackground = document.querySelector(".form-background");
  // Get the form container
  const formContainer = document.querySelector(".form-container");

  // Add container for submit and cancel buttons
  const buttonDiv = document.createElement("div");
  buttonDiv.classList.add("form-button-div");
  // Add input element of type submit
  const submitBtn = document.createElement("input");
  submitBtn.setAttribute("type", "submit");
  submitBtn.classList.add("edit-form-btn");
  // Add submit button to the button div
  buttonDiv.appendChild(submitBtn);
  // Add a button element for cancelling action
  const cancelBtn = document.createElement("button");
  cancelBtn.classList.add("edit-form-btn");
  // Set button text
  cancelBtn.textContent = "Cancel";
  // Add cancel button to the button div
  buttonDiv.appendChild(cancelBtn);
  // Add submit container to form container
  formContainer.appendChild(buttonDiv);

  // Add event listener to submit button
  submitBtn.addEventListener("click", () => {
    // Get name input element
    const nameInput = document.getElementById("name-input");

    // Check whether todo boolean is true
    const prioritySelect = priorityBool
      ? document.getElementById("priority-input")
      : null;

    // Get info input element
    const infoInput = document.getElementById("info-input");

    if (nameInput.value !== "") {
      // Change the name of object
      obj.name = nameInput.value;
      // If priority select is present then change the object priority
      if (prioritySelect !== null) {
        // Change the priority of object
        obj.priority = prioritySelect.value;
      }
      // Change the info of the object
      obj.info = infoInput.value;

      // Update project view
      updateProjView(proj.listArray);

      // Remove form background element from DOM
      formBackground.remove();
    } else {
      // Throw error and cancel submission of form
      alert("no name");
    }
  });

  // Add event listener to cancel button
  cancelBtn.addEventListener("click", () => {
    // Remove form background element from DOM
    formBackground.remove();
  });
}

// Todo edit form
function generateTodoForm(projId, projArray, listId, todoId) {
  // Get the project object from the project array
  const proj = returnObjectFromArray(projId, projArray);
  // Get the list object from the project's list array
  const list = returnObjectFromArray(listId, proj.listArray);
  // Get the todo object from the list's todo array
  const todo = returnObjectFromArray(todoId, list.todoArray);

  // Get current name of todo
  const currentName = todo.name;
  // Get current priority of todo
  const currentPriority = todo.priority;
  // Get current info of todo
  const currentInfo = todo.info;

  initForm();

  addNameInput(currentName);

  addPriorityInput(currentPriority);

  addInfoInput(currentInfo);

  addButtons(proj, todo, true);
}

// List edit form
function generateListForm(projId, projArray, listId) {
  // Get the project object from the project array
  const proj = returnObjectFromArray(projId, projArray);
  // Get the list object from the project's list array
  const list = returnObjectFromArray(listId, proj.listArray);

  // Get current name of list
  const currentName = list.name;
  // Get current info of list
  const currentInfo = list.info;

  initForm();

  addNameInput(currentName);

  addInfoInput(currentInfo);

  addButtons(proj, list, false);
}

// Project edit form
function generateProjForm(projId, projArray) {
  // Get the project object from the project array
  const proj = returnObjectFromArray(projId, projArray);

  // Get current name of project
  const currentName = proj.name;
  // Get the current info of project
  const currentInfo = proj.info;

  initForm();

  addNameInput(currentName);

  addInfoInput(currentInfo);

  addButtons(proj, proj, false);
}

export { generateTodoForm, generateListForm, generateProjForm };
